---
---

<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8 bg-astro-card p-8 rounded-xl">
    <div>
      <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-primary/10">
        <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
        </svg>
      </div>
      <h2 class="mt-6 text-center text-3xl font-extrabold text-foreground">
        Registrujte se za novi nalog
      </h2>
      <p class="mt-2 text-center text-sm text-muted-foreground">
        Ili
        <a href="/login" class="font-medium text-primary hover:text-primary/80">
          prijavite se na postojeći nalog
        </a>
      </p>
    </div>
    
    <form class="mt-8 space-y-6" id="register-form">
      <div class="space-y-4">
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label for="firstName" class="block text-sm font-medium text-foreground">Ime</label>
            <input
              id="firstName"
              name="firstName"
              type="text"
              required
              class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
              placeholder="Vaše ime"
            >
          </div>
          <div>
            <label for="lastName" class="block text-sm font-medium text-foreground">Prezime</label>
            <input
              id="lastName"
              name="lastName"
              type="text"
              required
              class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
              placeholder="Vaše prezime"
            >
          </div>
        </div>
        
        <div>
          <label for="email" class="block text-sm font-medium text-foreground">Email adresa</label>
          <input
            id="email"
            name="email"
            type="email"
            required
            class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
            placeholder="vaš@email.com"
          >
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium text-foreground">Lozinka</label>
          <input
            id="password"
            name="password"
            type="password"
            required
            class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
            placeholder="Minimalno 8 karaktera"
          >
        </div>
        
            <div>
              <label for="confirmPassword" class="block text-sm font-medium text-foreground">Potvrdite lozinku</label>
              <input
                id="confirmPassword"
                name="confirmPassword"
                type="password"
                required
                class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                placeholder="Ponovite lozinku"
              >
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium text-foreground">Telefon</label>
              <input
                id="phone"
                name="phone"
                type="tel"
                required
                class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                placeholder="+381 60 123 4567"
              >
            </div>
            
            <div>
              <label for="address" class="block text-sm font-medium text-foreground">Adresa</label>
              <input
                id="address"
                name="address"
                type="text"
                required
                class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                placeholder="Ulica i broj, Grad"
              >
            </div>
            
            <div>
              <label for="userType" class="block text-sm font-medium text-foreground">Tip korisnika</label>
              <select
                id="userType"
                name="userType"
                required
                class="mt-1 flex h-10 w-full rounded-md border border-input bg-astro-card px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
              >
                <option value="STUDENT">Student</option>
                <option value="PROFESSOR">Profesor</option>
                <option value="EMPLOYER">Poslodavac</option>
                <option value="CANDIDATE">Kandidat za posao</option>
                <option value="ADMIN">Administrator</option>
              </select>
            </div>
      </div>

      <div class="text-sm text-muted-foreground">
        Registracijom se slažete sa
        <a href="#" class="text-primary hover:text-primary/80">uslovima korišćenja</a>
      </div>

      <div id="error-message" class="bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-md text-sm hidden">
      </div>

      <div id="success-message" class="bg-green-500/10 border border-green-500/20 text-green-600 px-4 py-3 rounded-md text-sm hidden">
      </div>

      <div>
        <button
          type="submit"
          id="submit-button"
          class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 w-full"
        >
          <span id="button-text">Registrujte se</span>
        </button>
      </div>

      <div class="text-center">
        <a href="/" class="text-primary hover:text-primary/80 text-sm">
          ← Nazad na početnu
        </a>
      </div>
    </form>
  </div>
</div>

<script>
  import { authService } from '../lib/authService';

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('register-form') as HTMLFormElement;
    const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
    const buttonText = document.getElementById('button-text') as HTMLSpanElement;
    const errorMessage = document.getElementById('error-message') as HTMLDivElement;
    const successMessage = document.getElementById('success-message') as HTMLDivElement;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      submitButton.disabled = true;
      buttonText.textContent = 'Registracija...';
      errorMessage.classList.add('hidden');
      successMessage.classList.add('hidden');

      const formData = new FormData(form);
      const firstName = formData.get('firstName') as string;
      const lastName = formData.get('lastName') as string;
      const email = formData.get('email') as string;
      const password = formData.get('password') as string;
      const confirmPassword = formData.get('confirmPassword') as string;
      const phone = formData.get('phone') as string;
      const address = formData.get('address') as string;
      const userType = formData.get('userType') as string;

      if (!firstName || !lastName || !email || !password || !confirmPassword || !phone || !address || !userType) {
        errorMessage.textContent = 'Molimo popunite sva polja.';
        errorMessage.classList.remove('hidden');
        submitButton.disabled = false;
        buttonText.textContent = 'Registrujte se';
        return;
      }
      
      if (password !== confirmPassword) {
        errorMessage.textContent = 'Lozinke se ne poklapaju.';
        errorMessage.classList.remove('hidden');
        submitButton.disabled = false;
        buttonText.textContent = 'Registrujte se';
        return;
      }
      
      if (password.length < 8) {
        errorMessage.textContent = 'Lozinka mora imati najmanje 8 karaktera.';
        errorMessage.classList.remove('hidden');
        submitButton.disabled = false;
        buttonText.textContent = 'Registrujte se';
        return;
      }

      try {
        const userData = {
          first_name: firstName,
          last_name: lastName,
          email: email,
          password: password,
          phone: phone,
          address: address,
          user_type: userType as 'STUDENT' | 'PROFESSOR' | 'EMPLOYER' | 'CANDIDATE' | 'ADMIN'
        };

        const response = await authService.register(userData);
        
        console.log('Registration successful:', response);
        console.log('User microservice:', response.microservice);
        
        successMessage.textContent = 'Uspešno ste se registrovali! Preusmjeravamo vas...';
        successMessage.classList.remove('hidden');
        
        setTimeout(() => {
          if (response.microservice === 'university') {
            window.location.href = '/university-dashboard';
          } else if (response.microservice === 'employment') {
            window.location.href = '/employment-dashboard';
          } else {
            window.location.href = '/admin-dashboard';
          }
        }, 2000);
        
      } catch (error: any) {
        console.error('Registration error:', error);
      } finally {
        submitButton.disabled = false;
        buttonText.textContent = 'Registrujte se';
      }
    });
  });
</script>
